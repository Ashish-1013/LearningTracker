<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ashish â€“ Learning Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
    --primary: #4f46e5;
    --primary-light: #6366f1;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    
    --bg-primary: #f8fafc;
    --bg-secondary: #ffffff;
    --bg-sidebar: #1e293b;
    
    --text-primary: #0f172a;
    --text-secondary: #475569;
    --text-light: #64748b;
    --text-inverse: #f8fafc;
    
    --border-light: #e2e8f0;
    
    --radius-sm: 6px;
    --radius-md: 10px;
    --radius-lg: 14px;
}

body.dark {
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --bg-sidebar: #0f172a;
    
    --text-primary: #f1f5f9;
    --text-secondary: #cbd5e1;
    --text-light: #94a3b8;
    
    --border-light: #334155;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.5;
}

.hidden {
    display: none !important;
}

/* LOGIN - SIMPLE & FAST */
.login-container {
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.login-card {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: 30px;
    width: 100%;
    max-width: 400px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.login-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    color: white;
    font-weight: 700;
    font-size: 24px;
}

.login-card h1 {
    text-align: center;
    margin-bottom: 8px;
    font-size: 24px;
}

.login-card p {
    text-align: center;
    color: var(--text-secondary);
    margin-bottom: 25px;
    font-size: 14px;
}

.input-group {
    margin-bottom: 20px;
}

.input-group i {
    position: absolute;
    margin: 16px 0 0 16px;
    color: var(--text-light);
}

.login-card input {
    width: 100%;
    padding: 14px 14px 14px 45px;
    border: 1px solid var(--border-light);
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 15px;
}

.login-card input:focus {
    outline: none;
    border-color: var(--primary);
}

.login-btn {
    width: 100%;
    padding: 14px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 10px;
}

.login-btn:hover {
    background: var(--primary-light);
}

.error-message {
    color: var(--danger);
    font-size: 13px;
    text-align: center;
    margin-top: 10px;
    min-height: 20px;
}

/* HEADER */
.app-header {
    background: var(--bg-secondary);
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border-light);
}

.header-left {
    display: flex;
    align-items: center;
    gap: 12px;
}

.header-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
}

.header-info h1 {
    font-size: 18px;
    margin-bottom: 2px;
}

.header-info p {
    font-size: 12px;
    color: var(--text-secondary);
}

.header-actions {
    display: flex;
    gap: 8px;
}

.header-btn {
    width: 36px;
    height: 36px;
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* MAIN LAYOUT */
.app-container {
    display: flex;
    min-height: calc(100vh - 70px);
}

/* SIDEBAR */
.sidebar {
    width: 260px;
    background: var(--bg-sidebar);
    color: var(--text-inverse);
    padding: 20px 0;
    flex-shrink: 0;
    height: calc(100vh - 70px);
    overflow-y: auto;
}

.progress-widget {
    padding: 0 20px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 20px;
}

.progress-widget h3 {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 10px;
}

.progress-percent {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 10px;
    color: white;
}

.progress-bar {
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    margin-bottom: 8px;
}

.progress-fill {
    height: 100%;
    background: var(--primary);
    border-radius: 3px;
}

.quick-actions {
    padding: 0 20px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 20px;
}

.quick-btn {
    width: 100%;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-md);
    color: rgba(255, 255, 255, 0.9);
    font-size: 13px;
    margin-bottom: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
}

.quick-btn:hover {
    background: rgba(255, 255, 255, 0.1);
}

.phase-list {
    padding: 0 20px;
}

.phase-item {
    padding: 12px 15px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-md);
    color: rgba(255, 255, 255, 0.8);
    cursor: pointer;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.phase-item:hover {
    background: rgba(255, 255, 255, 0.1);
}

.phase-item.active {
    background: rgba(79, 70, 229, 0.2);
    border-color: rgba(79, 70, 229, 0.3);
}

.phase-icon {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-md);
    background: rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
}

.phase-content {
    flex: 1;
}

.phase-title {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 2px;
}

.phase-subtitle {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
}

.phase-progress {
    font-size: 11px;
    font-weight: 700;
    background: rgba(255, 255, 255, 0.1);
    padding: 3px 8px;
    border-radius: 10px;
}

/* MAIN CONTENT */
.main-content {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
}

.content-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-light);
}

.header-content {
    display: flex;
    align-items: center;
    gap: 15px;
}

.header-icon {
    width: 50px;
    height: 50px;
    border-radius: var(--radius-md);
    background: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
}

.header-text h2 {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 4px;
}

.header-text p {
    color: var(--text-secondary);
    font-size: 13px;
}

.view-tabs {
    display: flex;
    gap: 8px;
    background: var(--bg-primary);
    padding: 4px;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-light);
}

.view-tab {
    padding: 8px 16px;
    background: transparent;
    border: none;
    border-radius: var(--radius-sm);
    color: var(--text-secondary);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
}

.view-tab.active {
    background: var(--primary);
    color: white;
}

/* FOCUS VIEW */
.focus-view {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
}

.topic-content {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: 20px;
    border: 1px solid var(--border-light);
}

.topic-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-light);
}

.topic-title {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 8px;
}

.topic-tags {
    display: flex;
    gap: 8px;
}

.topic-tag {
    padding: 4px 10px;
    background: var(--bg-primary);
    border: 1px solid var(--border-light);
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-secondary);
}

.topic-tag.important {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning);
    border-color: rgba(245, 158, 11, 0.2);
}

.topic-actions {
    display: flex;
    gap: 8px;
}

.topic-btn {
    width: 36px;
    height: 36px;
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    border: 1px solid var(--border-light);
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

.progress-display {
    background: rgba(79, 70, 229, 0.05);
    border-radius: var(--radius-md);
    padding: 20px;
    margin-bottom: 25px;
    border: 1px dashed var(--border-light);
    display: flex;
    align-items: center;
    gap: 20px;
}

.progress-circle {
    position: relative;
    width: 80px;
    height: 80px;
}

.progress-ring-bg {
    fill: none;
    stroke: var(--border-light);
    stroke-width: 8;
}

.progress-ring {
    fill: none;
    stroke: var(--primary);
    stroke-width: 8;
    stroke-linecap: round;
    transform: rotate(-90deg);
    transform-origin: 50% 50%;
}

.progress-percent-large {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 18px;
    font-weight: 700;
}

.progress-details h4 {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 10px;
}

.progress-stats {
    display: flex;
    gap: 15px;
}

.stat-item {
    display: flex;
    flex-direction: column;
}

.stat-value {
    font-size: 18px;
    font-weight: 700;
    color: var(--primary);
}

.stat-label {
    font-size: 12px;
    color: var(--text-secondary);
}

.subtopics-section {
    margin-top: 25px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.section-header h3 {
    font-size: 16px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.toggle-all-btn {
    padding: 6px 12px;
    background: var(--bg-primary);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-md);
    color: var(--text-secondary);
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
}

.subtopics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 12px;
}

.subtopic-card {
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    padding: 15px;
    border: 1px solid var(--border-light);
    cursor: pointer;
}

.subtopic-card:hover {
    border-color: var(--primary);
}

.subtopic-card.completed {
    border-color: var(--success);
    background: rgba(16, 185, 129, 0.05);
}

.subtopic-check {
    display: flex;
    align-items: flex-start;
    gap: 12px;
}

.subtopic-check input[type="checkbox"] {
    width: 20px;
    height: 20px;
    border-radius: 5px;
    border: 2px solid var(--border-light);
    background: var(--bg-primary);
    cursor: pointer;
    margin-top: 2px;
}

.subtopic-check input[type="checkbox"]:checked {
    background: var(--success);
    border-color: var(--success);
}

.subtopic-title {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 14px;
}

.subtopic-card.completed .subtopic-title {
    color: var(--success);
    text-decoration: line-through;
}

/* NOTES SIDEBAR */
.notes-sidebar {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: 20px;
    border: 1px solid var(--border-light);
    height: fit-content;
}

.notes-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-light);
}

.notes-header h3 {
    font-size: 16px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.add-note-btn {
    padding: 8px 16px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
}

.add-note-btn:hover {
    background: var(--primary-light);
}

.notes-container {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-height: 500px;
    overflow-y: auto;
}

.note-card {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    border-radius: var(--radius-md);
    padding: 15px;
    position: relative;
    border: 1px solid rgba(0, 0, 0, 0.1);
}

.note-card:nth-child(2n) {
    background: linear-gradient(135deg, #dbeafe, #bfdbfe);
}

.note-card:nth-child(3n) {
    background: linear-gradient(135deg, #fce7f3, #f9a8d4);
}

.note-pin {
    position: absolute;
    top: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 16px;
    height: 16px;
    background: var(--danger);
    border-radius: 50%;
}

.note-text {
    width: 100%;
    min-height: 80px;
    background: transparent;
    border: none;
    color: #1f2937;
    font-size: 13px;
    line-height: 1.5;
    resize: none;
    font-family: 'Inter', sans-serif;
    outline: none;
    margin-bottom: 10px;
}

.note-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 10px;
    border-top: 1px dashed rgba(0, 0, 0, 0.1);
}

.note-date {
    font-size: 11px;
    color: rgba(0, 0, 0, 0.5);
    font-weight: 500;
}

.note-actions {
    display: flex;
    gap: 6px;
}

.note-btn {
    width: 24px;
    height: 24px;
    border-radius: 5px;
    background: rgba(255, 255, 255, 0.5);
    border: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0, 0, 0, 0.6);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
}

/* ALL TOPICS VIEW */
.all-topics-view {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

.phase-card {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: 20px;
    border: 1px solid var(--border-light);
}

.phase-card-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
}

.phase-card-icon {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-md);
    background: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 18px;
}

.phase-card-info h3 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 4px;
}

.phase-card-info p {
    font-size: 12px;
    color: var(--text-secondary);
}

.topic-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.topic-item {
    background: var(--bg-primary);
    border-radius: var(--radius-md);
    padding: 12px;
    border: 1px solid var(--border-light);
    cursor: pointer;
}

.topic-item:hover {
    background: var(--bg-secondary);
    border-color: var(--primary);
}

.topic-item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
}

.topic-item-title {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 14px;
}

.topic-item-progress {
    font-size: 12px;
    font-weight: 700;
    color: var(--primary);
}

.topic-item-status {
    font-size: 11px;
    color: var(--text-secondary);
}

/* EMPTY STATE */
.empty-state {
    text-align: center;
    padding: 40px 20px;
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    border: 1px dashed var(--border-light);
}

.empty-state-icon {
    font-size: 40px;
    color: var(--primary-light);
    margin-bottom: 15px;
    opacity: 0.5;
}

.empty-state h3 {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 8px;
}

.empty-state p {
    color: var(--text-secondary);
    font-size: 14px;
}

/* RESPONSIVE */
@media (max-width: 1024px) {
    .focus-view {
        grid-template-columns: 1fr;
    }
    
    .notes-sidebar {
        margin-top: 20px;
    }
}

@media (max-width: 768px) {
    .app-container {
        flex-direction: column;
    }
    
    .sidebar {
        width: 100%;
        height: auto;
    }
    
    .all-topics-view {
        grid-template-columns: 1fr;
    }
    
    .content-header {
        flex-direction: column;
        gap: 15px;
    }
}

@media (max-width: 480px) {
    .subtopics-grid {
        grid-template-columns: 1fr;
    }
    
    .topic-header {
        flex-direction: column;
        gap: 10px;
    }
}
</style>
</head>

<body>
<!-- LOGIN SCREEN -->
<div id="loginBox" class="login-container">
    <div class="login-card">
        <div class="login-avatar">A</div>
        <h1>Welcome Back, Ashish!</h1>
        <p>Continue your learning journey</p>
        
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input id="pwd" type="password" placeholder="Enter password: 9777641455">
        </div>
        
        <button class="login-btn" onclick="login()">
            <i class="fas fa-rocket"></i> Login
        </button>
        <div id="error" class="error-message"></div>
    </div>
</div>

<!-- MAIN APP -->
<div id="app" class="hidden">
    <!-- HEADER -->
    <header class="app-header">
        <div class="header-left">
            <div class="header-avatar">A</div>
            <div class="header-info">
                <h1>Ashish's Learning Dashboard</h1>
                <p>Full-Stack Development Progress</p>
            </div>
        </div>
        
        <div class="header-actions">
            <button class="header-btn" onclick="toggleTheme()" title="Toggle Theme">
                <i class="fas fa-moon"></i>
            </button>
            <button class="header-btn" onclick="showAllView()" title="All Topics">
                <i class="fas fa-th-large"></i>
            </button>
            <button class="header-btn" onclick="logout()" title="Logout">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </header>
    
    <!-- MAIN LAYOUT -->
    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="progress-widget">
                <h3>Overall Progress</h3>
                <div class="progress-percent" id="overallPercent">0%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="overallProgressFill"></div>
                </div>
            </div>
            
            <div class="quick-actions">
                <button class="quick-btn" onclick="showAllView()">
                    <i class="fas fa-th-large"></i>
                    All Topics
                </button>
            </div>
            
            <div class="phase-list" id="nav">
                <!-- Will be populated by JavaScript -->
            </div>
        </aside>
        
        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- CONTENT HEADER -->
            <div class="content-header">
                <div class="header-content">
                    <div class="header-icon" id="headerIcon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="header-text">
                        <h2 id="contentTitle">Learning Dashboard</h2>
                        <p id="contentSubtitle">Select a topic to begin</p>
                    </div>
                </div>
                
                <div class="view-tabs">
                    <button class="view-tab active" onclick="setViewMode('focus')">
                        <i class="fas fa-eye"></i>
                        Focus
                    </button>
                    <button class="view-tab" onclick="setViewMode('all')">
                        <i class="fas fa-layer-group"></i>
                        All Topics
                    </button>
                </div>
            </div>
            
            <!-- FOCUS VIEW -->
            <div id="focusView" class="focus-view">
                <div class="topic-content">
                    <div class="topic-header">
                        <div>
                            <h1 class="topic-title" id="topicTitle">Select a Topic</h1>
                            <div class="topic-tags" id="topicTags"></div>
                        </div>
                        <div class="topic-actions">
                            <button class="topic-btn" onclick="toggleAllSubtopics()" title="Toggle All">
                                <i class="fas fa-check-double"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="progress-display">
                        <div class="progress-circle">
                            <svg width="80" height="80" viewBox="0 0 100 100">
                                <circle class="progress-ring-bg" cx="50" cy="50" r="45"></circle>
                                <circle class="progress-ring" id="topicProgressRing" cx="50" cy="50" r="45" 
                                        stroke-dasharray="283" stroke-dashoffset="283"></circle>
                            </svg>
                            <div class="progress-percent-large" id="topicProgressPercent">0%</div>
                        </div>
                        <div class="progress-details">
                            <h4>Topic Progress</h4>
                            <div class="progress-stats">
                                <div class="stat-item">
                                    <div class="stat-value" id="completedCount">0</div>
                                    <div class="stat-label">Completed</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="totalCount">0</div>
                                    <div class="stat-label">Total</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="remainingCount">0</div>
                                    <div class="stat-label">Remaining</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="subtopics-section">
                        <div class="section-header">
                            <h3><i class="fas fa-list-check"></i> Subtopics</h3>
                            <button class="toggle-all-btn" onclick="toggleAllSubtopics()">
                                Toggle All
                            </button>
                        </div>
                        <div class="subtopics-grid" id="subtopicsGrid">
                            <!-- Subtopics will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div class="notes-sidebar">
                    <div class="notes-header">
                        <h3><i class="fas fa-sticky-note"></i> Notes</h3>
                        <button class="add-note-btn" onclick="addNote()">
                            <i class="fas fa-plus"></i> Add
                        </button>
                    </div>
                    <div class="notes-container" id="notesContainer">
                        <!-- Notes will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- ALL TOPICS VIEW -->
            <div id="allView" class="hidden">
                <div class="all-topics-view" id="allTopicsContainer">
                    <!-- All topics will be loaded here -->
                </div>
            </div>
            
            <!-- EMPTY STATE -->
            <div id="emptyState" class="empty-state">
                <div class="empty-state-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                <h3>Ready to Learn?</h3>
                <p>Select a topic from the sidebar to begin</p>
            </div>
        </main>
    </div>
</div>

<script>
// ==================== CONSTANTS ====================
const PASSWORD = "9777641455";
const STORAGE_KEYS = {
    LOGIN: 'lms_login',
    THEME: 'lms_theme',
    PROGRESS: 'lms_progress',
    NOTES: 'lms_notes',
    LAST_VIEW: 'lms_last_view',
    LAST_TOPIC: 'lms_last_topic'
};

// Syllabus data (simplified for speed)
const syllabus = [
    { id: "html", phase: "HTML Fundamentals", icon: "fab fa-html5", color: "#e34c26" },
    { id: "css", phase: "CSS Styling", icon: "fab fa-css3-alt", color: "#264de4" },
    { id: "js", phase: "JavaScript Core", icon: "fab fa-js-square", color: "#f0db4f" },
    { id: "react", phase: "React Framework", icon: "fab fa-react", color: "#61dafb" },
    { id: "node", phase: "Node.js Backend", icon: "fab fa-node-js", color: "#68a063" },
    { id: "db", phase: "Databases", icon: "fas fa-database", color: "#00618a" },
    { id: "spring", phase: "Spring Boot", icon: "fas fa-leaf", color: "#6db33f" },
    { id: "lms", phase: "EdTech & LMS", icon: "fas fa-graduation-cap", color: "#8b5cf6" }
];

// Topic data
const topics = {
    html: {
        title: "HTML Mastery",
        important: true,
        subs: [
            "HTML Basics & History",
            "Document Structure & DOCTYPE",
            "HTML5 Semantic Elements",
            "Forms & Input Types",
            "Tables & Lists",
            "Multimedia (Audio, Video, Canvas)",
            "Graphics (SVG, Canvas)",
            "APIs (Geolocation, Drag & Drop)",
            "Web Storage & IndexedDB",
            "Web Workers & Service Workers",
            "Web Sockets & WebRTC",
            "Microdata & RDFa",
            "MathML & Web Components",
            "Progressive Web Apps (PWA)",
            "Web Accessibility (WCAG, ARIA)",
            "SEO Optimization Techniques",
            "Internationalization (i18n)",
            "Performance Optimization",
            "Security Best Practices",
            "HTML Validation & Testing"
        ]
    },
    css: {
        title: "CSS Complete Guide",
        important: true,
        subs: [
            "CSS Basics & Selectors",
            "Box Model & Positioning",
            "Typography & Fonts",
            "Colors & Gradients",
            "Transitions & Animations",
            "Flexbox Layout System",
            "CSS Grid Layout",
            "Multi-column Layout",
            "Responsive Design Principles",
            "Media Queries & Breakpoints",
            "CSS Variables (Custom Properties)",
            "CSS Functions (calc(), clamp())",
            "Pseudo-classes & Pseudo-elements",
            "CSS Transforms (2D & 3D)",
            "Filters & Blend Modes",
            "CSS Shapes & Clip-path",
            "Scroll Snap & Overscroll",
            "CSS Modules & Scoping",
            "CSS-in-JS Solutions",
            "CSS Frameworks (Tailwind, Bootstrap)",
            "CSS Methodologies (BEM, OOCSS)",
            "Performance Optimization",
            "Cross-browser Compatibility",
            "CSS Architecture",
            "CSS Preprocessors (SASS, LESS)"
        ]
    },
    js: {
        title: "JavaScript Deep Dive",
        important: true,
        subs: [
            "JavaScript Fundamentals",
            "ES6+ Features (let/const, arrow functions)",
            "Data Types & Type Coercion",
            "Functions & Scope",
            "Arrays & Array Methods",
            "Objects & Prototypes",
            "Classes & OOP in JS",
            "Modules (ES6, CommonJS)",
            "Asynchronous JavaScript",
            "Promises & Async/Await",
            "Error Handling",
            "Regular Expressions",
            "DOM Manipulation",
            "Events & Event Delegation",
            "Web APIs (Fetch, Storage)",
            "Browser APIs (History, Location)",
            "JavaScript Engines (V8)",
            "Memory Management",
            "Closures & Currying",
            "Functional Programming",
            "Design Patterns",
            "Testing (Jest, Mocha)",
            "Debugging & DevTools",
            "Performance Optimization",
            "Security (XSS, CSRF)",
            "TypeScript Basics",
            "Node.js Fundamentals",
            "Build Tools (Webpack, Vite)",
            "Package Management (npm, yarn)"
        ]
    },
    react: {
        title: "React Ecosystem",
        important: true,
        subs: [
            "React Fundamentals",
            "JSX & Virtual DOM",
            "Components (Class & Functional)",
            "Props & State Management",
            "Lifecycle Methods",
            "Hooks (useState, useEffect, custom)",
            "Context API",
            "React Router",
            "Forms & Form Validation",
            "Error Boundaries",
            "Code Splitting & Lazy Loading",
            "Server-side Rendering (SSR)",
            "Static Site Generation (SSG)",
            "Performance Optimization",
            "Testing (React Testing Library)",
            "State Management Libraries",
            "Redux & Redux Toolkit",
            "MobX & Zustand",
            "React Query & SWR",
            "GraphQL with React",
            "Authentication & Authorization",
            "Progressive Web Apps",
            "React Native Basics",
            "Next.js Framework",
            "Gatsby Framework",
            "React Ecosystem Tools",
            "Best Practices & Patterns"
        ]
    },
    node: {
        title: "Node.js & Backend Development",
        important: true,
        subs: [
            "Node.js Fundamentals",
            "Event Loop & Non-blocking I/O",
            "Modules & NPM",
            "File System Operations",
            "Streams & Buffers",
            "Event Emitters",
            "Child Processes",
            "Cluster Module",
            "Express.js Framework",
            "Middleware Architecture",
            "Routing & Controllers",
            "Request/Response Handling",
            "Error Handling Middleware",
            "Authentication (JWT, OAuth)",
            "Authorization & RBAC",
            "Security Best Practices",
            "Validation & Sanitization",
            "File Uploads (Multer)",
            "Real-time Communication (Socket.io)",
            "REST API Design",
            "GraphQL with Node.js",
            "Database Integration",
            "Caching Strategies",
            "Message Queues (Redis, RabbitMQ)",
            "Microservices Architecture",
            "Docker & Containerization",
            "API Documentation (Swagger)",
            "Testing (Jest, Supertest)",
            "Deployment Strategies",
            "Performance Monitoring"
        ]
    },
    db: {
        title: "Databases & Data Management",
        important: true,
        subs: [
            "Database Fundamentals",
            "Relational Databases (RDBMS)",
            "SQL Basics & Advanced Queries",
            "Joins & Subqueries",
            "Indexes & Optimization",
            "Transactions & ACID Properties",
            "MySQL Database",
            "PostgreSQL Database",
            "SQL Server",
            "NoSQL Databases Overview",
            "MongoDB Fundamentals",
            "Document Databases",
            "Key-Value Stores (Redis)",
            "Column-family Stores (Cassandra)",
            "Graph Databases (Neo4j)",
            "Time-series Databases",
            "In-memory Databases",
            "Database Design & Normalization",
            "ORM/ODM Concepts",
            "Sequelize (SQL ORM)",
            "Mongoose (MongoDB ODM)",
            "Prisma ORM",
            "Database Migrations",
            "Replication & Sharding",
            "Backup & Recovery",
            "Database Security",
            "Data Modeling",
            "ETL Processes",
            "Data Warehousing",
            "Big Data Technologies"
        ]
    },
    spring: {
        title: "Spring Boot & Java Ecosystem",
        important: true,
        subs: [
            "Java Fundamentals",
            "Spring Framework Overview",
            "Spring Boot Basics",
            "Dependency Injection (DI)",
            "Inversion of Control (IoC)",
            "Spring MVC Architecture",
            "Controllers & Request Mapping",
            "Spring Data JPA",
            "Entity Relationships",
            "Repository Pattern",
            "Spring Security",
            "Authentication & Authorization",
            "OAuth2 & JWT",
            "Spring REST API Development",
            "DTO Pattern & ModelMapper",
            "Validation & Exception Handling",
            "Spring Boot Actuator",
            "Spring Boot Testing",
            "Spring Boot DevTools",
            "Spring Boot Configuration",
            "Profiles & Environment",
            "Spring Boot Database Integration",
            "Spring Boot Caching",
            "Spring Boot Scheduling",
            "Spring Boot Messaging",
            "Microservices with Spring Cloud",
            "Service Discovery (Eureka)",
            "API Gateway (Zuul)",
            "Configuration Server",
            "Circuit Breaker (Hystrix)",
            "Docker Integration",
            "Kubernetes Deployment",
            "Spring Boot Monitoring",
            "Best Practices & Patterns"
        ]
    },
    lms: {
        title: "EdTech & Learning Systems",
        important: true,
        subs: [
            "eLearning Fundamentals",
            "LMS Architecture & Components",
            "SCORM Standards (1.2, 2004)",
            "xAPI (Tin Can API)",
            "AICC & cmi5",
            "LTI (Learning Tools Interoperability)",
            "Content Packaging",
            "Manifest Files (imsmanifest.xml)",
            "Tracking & Reporting",
            "Completion & Success Status",
            "Score & Time Tracking",
            "Suspend Data Management",
            "Communication API",
            "Launch & Initialization",
            "Runtime Environment",
            "Sequencing & Navigation",
            "Assessment & Quizzes",
            "Grading & Rubrics",
            "Analytics & Reporting",
            "Competency-based Learning",
            "Adaptive Learning Systems",
            "Gamification in eLearning",
            "Social Learning Features",
            "Mobile Learning (mLearning)",
            "Video-based Learning",
            "Virtual & Augmented Reality",
            "AI in Education",
            "Accessibility in eLearning",
            "Localization & Globalization",
            "LMS Integration Patterns",
            "Cloud-based LMS Solutions",
            "Open Source LMS (Moodle)",
            "Commercial LMS (Canvas, Blackboard)",
            "Content Authoring Tools",
            "Future of EdTech"
        ]
    },
    devops: {
        title: "DevOps & Cloud Infrastructure",
        important: true,
        subs: [
            "DevOps Culture & Principles",
            "Version Control (Git)",
            "CI/CD Pipeline",
            "Jenkins & Automation",
            "GitLab CI/CD",
            "GitHub Actions",
            "Docker & Containers",
            "Container Orchestration",
            "Kubernetes Fundamentals",
            "Helm Charts",
            "Infrastructure as Code",
            "Terraform & Ansible",
            "Cloud Computing Basics",
            "AWS Services Overview",
            "Azure Cloud Services",
            "Google Cloud Platform",
            "Serverless Architecture",
            "Lambda Functions",
            "API Gateway",
            "Monitoring & Logging",
            "Prometheus & Grafana",
            "ELK Stack (Elasticsearch)",
            "Security & Compliance",
            "Networking & Load Balancing",
            "Database as a Service",
            "Microservices Deployment",
            "Blue-Green Deployment",
            "Canary Releases",
            "Disaster Recovery",
            "Cost Optimization"
        ]
    },
    testing: {
        title: "Software Testing & Quality",
        important: true,
        subs: [
            "Testing Fundamentals",
            "Testing Pyramid",
            "Unit Testing",
            "Integration Testing",
            "End-to-End Testing",
            "Test-Driven Development (TDD)",
            "Behavior-Driven Development (BDD)",
            "Testing Frameworks (Jest, Mocha)",
            "Mocking & Stubbing",
            "Test Coverage & Reporting",
            "Performance Testing",
            "Load Testing (JMeter)",
            "Security Testing",
            "Accessibility Testing",
            "Cross-browser Testing",
            "Mobile Testing",
            "API Testing",
            "Visual Regression Testing",
            "Continuous Testing",
            "Test Automation",
            "Selenium WebDriver",
            "Cypress Testing",
            "Playwright Testing",
            "Testing Best Practices",
            "Quality Assurance Process",
            "Code Review Techniques",
            "Static Code Analysis",
            "Dynamic Analysis",
            "Testing in Agile/DevOps"
        ]
    },
    architecture: {
        title: "System Design & Architecture",
        important: true,
        subs: [
            "System Design Fundamentals",
            "Architectural Patterns",
            "Monolithic Architecture",
            "Microservices Architecture",
            "Serverless Architecture",
            "Event-Driven Architecture",
            "CQRS Pattern",
            "Event Sourcing",
            "Hexagonal Architecture",
            "Clean Architecture",
            "Domain-Driven Design (DDD)",
            "Design Principles (SOLID)",
            "Design Patterns",
            "Scalability Patterns",
            "Performance Optimization",
            "Caching Strategies",
            "Load Balancing",
            "Database Sharding",
            "Message Queues",
            "API Gateway Pattern",
            "Service Discovery",
            "Circuit Breaker Pattern",
            "Rate Limiting",
            "Security Architecture",
            "Data Modeling",
            "API Design Principles",
            "Distributed Systems",
            "CAP Theorem",
            "Consensus Algorithms"
        ]
    },
    agile: {
        title: "Agile & Project Management",
        important: true,
        subs: [
            "Agile Manifesto & Principles",
            "Scrum Framework",
            "Kanban Methodology",
            "Lean Development",
            "Extreme Programming (XP)",
            "SAFe Framework",
            "Agile Project Management",
            "User Stories & Backlog",
            "Sprint Planning & Execution",
            "Daily Standups",
            "Sprint Review & Retrospective",
            "Velocity & Burn-down Charts",
            "Product Ownership",
            "Stakeholder Management",
            "Risk Management",
            "Estimation Techniques",
            "Prioritization Methods",
            "Team Collaboration",
            "Remote Agile Teams",
            "Tools (Jira, Trello, Asana)",
            "Continuous Improvement",
            "Agile Metrics & KPIs",
            "DevOps Integration",
            "Business Analysis",
            "Requirements Gathering",
            "Documentation in Agile",
            "Testing in Agile",
            "Agile Coaching",
            "Scrum Master Skills",
            "Product Manager Role"
        ]
    },
    security: {
        title: "Web Security & Cybersecurity",
        important: true,
        subs: [
            "Security Fundamentals",
            "OWASP Top 10",
            "Authentication Methods",
            "Authorization Systems",
            "Session Management",
            "Cross-Site Scripting (XSS)",
            "Cross-Site Request Forgery (CSRF)",
            "SQL Injection",
            "API Security",
            "Data Encryption",
            "HTTPS & SSL/TLS",
            "JWT Security",
            "OAuth 2.0 & OpenID Connect",
            "Security Headers",
            "Content Security Policy (CSP)",
            "Input Validation & Sanitization",
            "Rate Limiting & Throttling",
            "Security Testing",
            "Penetration Testing",
            "Vulnerability Assessment",
            "Security Monitoring",
            "Incident Response",
            "Compliance (GDPR, HIPAA)",
            "Privacy by Design",
            "Secure Coding Practices",
            "Infrastructure Security",
            "Network Security",
            "Cloud Security",
            "Mobile Security",
            "IoT Security"
        ]
    },
    tools: {
        title: "Developer Tools & Productivity",
        important: true,
        subs: [
            "Version Control (Git)",
            "IDE & Code Editors",
            "VS Code Mastery",
            "IntelliJ IDEA",
            "Terminal & Shell Scripting",
            "Package Managers",
            "Build Tools",
            "Task Runners",
            "Module Bundlers",
            "Linters & Formatters",
            "Debugging Tools",
            "Browser DevTools",
            "API Testing Tools",
            "Database Clients",
            "Container Tools",
            "Cloud CLI Tools",
            "Monitoring Tools",
            "Logging Tools",
            "Collaboration Tools",
            "Documentation Tools",
            "Diagramming Tools",
            "Performance Tools",
            "Security Tools",
            "Automation Tools",
            "CI/CD Tools",
            "Project Management Tools",
            "Communication Tools",
            "Time Management Tools",
            "Learning Resources",
            "Developer Communities"
        ]
    },
    softskills: {
        title: "Soft Skills & Career Development",
        important: true,
        subs: [
            "Communication Skills",
            "Technical Writing",
            "Presentation Skills",
            "Team Collaboration",
            "Conflict Resolution",
            "Leadership Skills",
            "Time Management",
            "Problem Solving",
            "Critical Thinking",
            "Creativity & Innovation",
            "Adaptability",
            "Emotional Intelligence",
            "Negotiation Skills",
            "Networking Skills",
            "Interview Preparation",
            "Resume Building",
            "LinkedIn Optimization",
            "Portfolio Development",
            "Career Planning",
            "Salary Negotiation",
            "Public Speaking",
            "Mentorship Skills",
            "Remote Work Skills",
            "Work-Life Balance",
            "Stress Management",
            "Continuous Learning",
            "Personal Branding",
            "Professional Ethics",
            "Cultural Awareness",
            "Business Acumen"
        ]
    }
};

// ==================== STATE ====================
let progressData = JSON.parse(localStorage.getItem(STORAGE_KEYS.PROGRESS)) || {};
let notesData = JSON.parse(localStorage.getItem(STORAGE_KEYS.NOTES)) || [];
let currentPhase = null;
let currentTopic = null;
let currentView = 'focus';

// ==================== CORE FUNCTIONS ====================

// Fast login - no loading screen
function login() {
    const pwdInput = document.getElementById('pwd');
    const errorMsg = document.getElementById('error');
    
    if (pwdInput.value === PASSWORD) {
        localStorage.setItem(STORAGE_KEYS.LOGIN, "true");
        showApp();
        errorMsg.textContent = "";
    } else {
        errorMsg.textContent = "Incorrect password";
        pwdInput.focus();
        pwdInput.value = "";
    }
}

// Show app instantly
function showApp() {
    document.getElementById('loginBox').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    
    // Load saved state
    loadSavedState();
    
    // Initialize app
    initApp();
}

// Load saved state
function loadSavedState() {
    // Theme
    if (localStorage.getItem(STORAGE_KEYS.THEME) === 'true') {
        document.body.classList.add('dark');
        const themeIcon = document.querySelector('.fa-moon');
        if (themeIcon) themeIcon.className = 'fas fa-sun';
    }
    
    // Last view and topic
    currentView = localStorage.getItem(STORAGE_KEYS.LAST_VIEW) || 'focus';
    const lastTopic = localStorage.getItem(STORAGE_KEYS.LAST_TOPIC);
    
    if (lastTopic) {
        const phase = syllabus.find(p => p.id === lastTopic);
        if (phase) {
            currentPhase = phase;
            currentTopic = topics[phase.id];
        }
    }
}

// Initialize app
function initApp() {
    renderSidebar();
    updateOverallProgress();
    
    if (currentPhase && currentTopic) {
        loadTopic(currentPhase, currentTopic);
        setViewMode(currentView);
    } else {
        showEmptyState();
    }
}

// Save state
function saveState() {
    if (currentPhase) {
        localStorage.setItem(STORAGE_KEYS.LAST_TOPIC, currentPhase.id);
    }
    localStorage.setItem(STORAGE_KEYS.LAST_VIEW, currentView);
    localStorage.setItem(STORAGE_KEYS.PROGRESS, JSON.stringify(progressData));
    localStorage.setItem(STORAGE_KEYS.NOTES, JSON.stringify(notesData));
}

// Logout
function logout() {
    localStorage.removeItem(STORAGE_KEYS.LOGIN);
    location.reload();
}

// Toggle theme
function toggleTheme() {
    document.body.classList.toggle('dark');
    const isDark = document.body.classList.contains('dark');
    localStorage.setItem(STORAGE_KEYS.THEME, isDark);
    
    const themeIcon = document.querySelector('.fa-moon, .fa-sun');
    themeIcon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
}

// ==================== RENDERING ====================

// Render sidebar
function renderSidebar() {
    const nav = document.getElementById('nav');
    nav.innerHTML = '';
    
    syllabus.forEach(section => {
        const total = topics[section.id]?.subs.length || 0;
        let done = 0;
        
        if (topics[section.id]) {
            topics[section.id].subs.forEach((sub, index) => {
                const key = `${section.id}_${index}`;
                if (progressData[key]) done++;
            });
        }
        
        const percent = total > 0 ? Math.round((done / total) * 100) : 0;
        
        const phaseItem = document.createElement('div');
        phaseItem.className = 'phase-item';
        if (currentPhase?.id === section.id) {
            phaseItem.classList.add('active');
        }
        
        phaseItem.innerHTML = `
            <div class="phase-icon" style="background: ${section.color}">
                <i class="${section.icon}"></i>
            </div>
            <div class="phase-content">
                <div class="phase-title">${section.phase}</div>
            </div>
            <div class="phase-progress">${percent}%</div>
        `;
        
        phaseItem.onclick = () => {
            currentPhase = section;
            currentTopic = topics[section.id];
            loadTopic(section, topics[section.id]);
            setViewMode('focus');
            
            document.querySelectorAll('.phase-item').forEach(item => {
                item.classList.remove('active');
            });
            phaseItem.classList.add('active');
            
            saveState();
        };
        
        nav.appendChild(phaseItem);
    });
}

// Load topic
function loadTopic(section, topic) {
    currentPhase = section;
    currentTopic = topic;
    
    // Update header
    document.getElementById('contentTitle').textContent = topic.title;
    document.getElementById('contentSubtitle').textContent = section.phase;
    document.getElementById('headerIcon').innerHTML = `<i class="${section.icon}"></i>`;
    
    // Show focus view
    document.getElementById('emptyState').classList.add('hidden');
    document.getElementById('focusView').classList.remove('hidden');
    document.getElementById('allView').classList.add('hidden');
    
    // Update view tabs
    document.querySelectorAll('.view-tab').forEach(tab => tab.classList.remove('active'));
    document.querySelector('.view-tab:first-child').classList.add('active');
    
    // Render topic content
    renderTopicContent(section, topic);
    
    saveState();
}

// Render topic content
function renderTopicContent(section, topic) {
    // Calculate progress
    const total = topic.subs.length;
    let done = 0;
    topic.subs.forEach((sub, index) => {
        const key = `${section.id}_${index}`;
        if (progressData[key]) done++;
    });
    const percent = total > 0 ? Math.round((done / total) * 100) : 0;
    
    // Update UI
    document.getElementById('topicTitle').textContent = topic.title;
    document.getElementById('topicTags').innerHTML = `
        <span class="topic-tag">${section.phase}</span>
        ${topic.important ? '<span class="topic-tag important">Important</span>' : ''}
    `;
    
    // Update progress
    const progressRing = document.getElementById('topicProgressRing');
    const dashoffset = 283 - (283 * percent) / 100;
    progressRing.style.strokeDashoffset = dashoffset;
    document.getElementById('topicProgressPercent').textContent = `${percent}%`;
    document.getElementById('completedCount').textContent = done;
    document.getElementById('totalCount').textContent = total;
    document.getElementById('remainingCount').textContent = total - done;
    
    // Render subtopics
    renderSubtopics(section, topic);
    
    // Render notes
    renderNotes();
}

// Render subtopics
function renderSubtopics(section, topic) {
    const subtopicsGrid = document.getElementById('subtopicsGrid');
    subtopicsGrid.innerHTML = '';
    
    topic.subs.forEach((sub, index) => {
        const key = `${section.id}_${index}`;
        const isChecked = progressData[key] || false;
        
        const subtopicCard = document.createElement('div');
        subtopicCard.className = `subtopic-card ${isChecked ? 'completed' : ''}`;
        subtopicCard.innerHTML = `
            <div class="subtopic-check">
                <input type="checkbox" id="${key}" ${isChecked ? 'checked' : ''}
                       onchange="toggleProgress('${key}', this.checked)">
                <div class="subtopic-title">${sub}</div>
            </div>
        `;
        subtopicsGrid.appendChild(subtopicCard);
    });
}

// Toggle progress
function toggleProgress(key, isChecked) {
    progressData[key] = isChecked;
    
    // Update UI
    const checkbox = document.getElementById(key);
    const subtopicCard = checkbox.closest('.subtopic-card');
    subtopicCard.classList.toggle('completed', isChecked);
    
    // Update progress
    updateOverallProgress();
    updateTopicProgress();
    
    // Save
    saveState();
}

// Update overall progress
function updateOverallProgress() {
    let total = 0;
    let done = 0;
    
    syllabus.forEach(section => {
        const topic = topics[section.id];
        if (topic) {
            topic.subs.forEach((sub, index) => {
                total++;
                const key = `${section.id}_${index}`;
                if (progressData[key]) done++;
            });
        }
    });
    
    const percent = total > 0 ? Math.round((done / total) * 100) : 0;
    document.getElementById('overallPercent').textContent = `${percent}%`;
    document.getElementById('overallProgressFill').style.width = `${percent}%`;
}

// Update topic progress
function updateTopicProgress() {
    if (!currentPhase || !currentTopic) return;
    
    const total = currentTopic.subs.length;
    let done = 0;
    currentTopic.subs.forEach((sub, index) => {
        const key = `${currentPhase.id}_${index}`;
        if (progressData[key]) done++;
    });
    
    const percent = total > 0 ? Math.round((done / total) * 100) : 0;
    const progressRing = document.getElementById('topicProgressRing');
    const dashoffset = 283 - (283 * percent) / 100;
    progressRing.style.strokeDashoffset = dashoffset;
    document.getElementById('topicProgressPercent').textContent = `${percent}%`;
    document.getElementById('completedCount').textContent = done;
    document.getElementById('remainingCount').textContent = total - done;
}

// ==================== NOTES ====================

// Render notes
function renderNotes() {
    const notesContainer = document.getElementById('notesContainer');
    const topicId = currentPhase?.id;
    
    // Filter notes for current topic
    const topicNotes = notesData.filter(note => note.topicId === topicId);
    
    if (topicNotes.length === 0) {
        notesContainer.innerHTML = `
            <div style="text-align: center; padding: 20px; color: var(--text-secondary); font-size: 13px;">
                No notes yet. Add your first note!
            </div>
        `;
        return;
    }
    
    notesContainer.innerHTML = '';
    topicNotes.forEach((note, index) => {
        notesContainer.appendChild(createNoteElement(note, index));
    });
    
    // Add event listeners
    setTimeout(() => {
        document.querySelectorAll('.note-text').forEach((textarea, index) => {
            textarea.addEventListener('input', function() {
                updateNote(topicNotes[index].id, this.value);
            });
        });
    }, 50);
}

// Create note element
function createNoteElement(note, index) {
    const noteDiv = document.createElement('div');
    noteDiv.className = 'note-card';
    noteDiv.innerHTML = `
        <div class="note-pin"></div>
        <textarea class="note-text" placeholder="Write your note...">${note.text}</textarea>
        <div class="note-footer">
            <div class="note-date">${formatDate(note.createdAt)}</div>
            <div class="note-actions">
                <button class="note-btn" onclick="deleteNote('${note.id}')" title="Delete">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `;
    return noteDiv;
}

// Add note
function addNote() {
    if (!currentPhase || !currentTopic) {
        alert('Select a topic first!');
        return;
    }
    
    const newNote = {
        id: Date.now().toString(),
        text: '',
        topicId: currentPhase.id,
        createdAt: Date.now()
    };
    
    notesData.unshift(newNote);
    renderNotes();
    
    // Focus on new note
    setTimeout(() => {
        const textarea = document.querySelector('.note-text');
        if (textarea) textarea.focus();
    }, 50);
    
    saveState();
}

// Update note
function updateNote(noteId, text) {
    const note = notesData.find(n => n.id === noteId);
    if (note) {
        note.text = text;
        saveState();
    }
}

// Delete note
function deleteNote(noteId) {
    if (confirm('Delete this note?')) {
        notesData = notesData.filter(note => note.id !== noteId);
        renderNotes();
        saveState();
    }
}

// Format date
function formatDate(timestamp) {
    const date = new Date(timestamp);
    const now = new Date();
    const diff = now - date;
    
    if (diff < 60000) return 'Just now';
    if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
    if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
    
    return date.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric' 
    });
}

// ==================== VIEW MANAGEMENT ====================

// Set view mode
function setViewMode(mode) {
    currentView = mode;
    
    // Hide all views
    document.getElementById('focusView').classList.add('hidden');
    document.getElementById('allView').classList.add('hidden');
    document.getElementById('emptyState').classList.add('hidden');
    
    // Update tabs
    document.querySelectorAll('.view-tab').forEach(tab => tab.classList.remove('active'));
    
    if (mode === 'focus') {
        document.getElementById('focusView').classList.remove('hidden');
        document.querySelector('.view-tab:first-child').classList.add('active');
        if (currentPhase && currentTopic) {
            renderTopicContent(currentPhase, currentTopic);
        }
    } else if (mode === 'all') {
        document.getElementById('allView').classList.remove('hidden');
        document.querySelector('.view-tab:last-child').classList.add('active');
        renderAllTopicsView();
    }
    
    saveState();
}

// Show all topics view
function showAllView() {
    setViewMode('all');
}

// Show empty state
function showEmptyState() {
    document.getElementById('emptyState').classList.remove('hidden');
    document.getElementById('focusView').classList.add('hidden');
    document.getElementById('allView').classList.add('hidden');
}

// Render all topics view
function renderAllTopicsView() {
    const container = document.getElementById('allTopicsContainer');
    container.innerHTML = '';
    
    syllabus.forEach(section => {
        const topic = topics[section.id];
        const total = topic?.subs.length || 0;
        let done = 0;
        
        if (topic) {
            topic.subs.forEach((sub, index) => {
                const key = `${section.id}_${index}`;
                if (progressData[key]) done++;
            });
        }
        
        const percent = total > 0 ? Math.round((done / total) * 100) : 0;
        
        const phaseCard = document.createElement('div');
        phaseCard.className = 'phase-card';
        phaseCard.innerHTML = `
            <div class="phase-card-header">
                <div class="phase-card-icon" style="background: ${section.color}">
                    <i class="${section.icon}"></i>
                </div>
                <div class="phase-card-info">
                    <h3>${section.phase}</h3>
                    <p>${topic?.title || ''}</p>
                </div>
            </div>
            <div class="topic-list">
                <div class="topic-item" onclick="loadTopic('${section.id}', topics['${section.id}']); setViewMode('focus');">
                    <div class="topic-item-header">
                        <div class="topic-item-title">${topic?.title || ''}</div>
                        <div class="topic-item-progress">${percent}%</div>
                    </div>
                    <div class="topic-item-status">
                        ${done}/${total} completed
                    </div>
                </div>
            </div>
        `;
        container.appendChild(phaseCard);
    });
}

// ==================== UI FUNCTIONS ====================

// Toggle all subtopics
function toggleAllSubtopics() {
    if (!currentPhase || !currentTopic) return;
    
    const checkboxes = document.querySelectorAll('.subtopic-check input[type="checkbox"]');
    const allChecked = Array.from(checkboxes).every(cb => cb.checked);
    
    checkboxes.forEach(cb => {
        const key = cb.id;
        const isChecked = !allChecked;
        cb.checked = isChecked;
        progressData[key] = isChecked;
        
        const subtopicCard = cb.closest('.subtopic-card');
        subtopicCard.classList.toggle('completed', isChecked);
    });
    
    updateOverallProgress();
    updateTopicProgress();
    saveState();
}

// ==================== INITIALIZATION ====================

// Check if already logged in
if (localStorage.getItem(STORAGE_KEYS.LOGIN) === 'true') {
    showApp();
}

// Enter key login
document.getElementById('pwd').addEventListener('keyup', function(event) {
    if (event.key === 'Enter') {
        login();
    }
});
</script>
</body>
</html>